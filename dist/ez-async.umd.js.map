{"version":3,"file":null,"sources":["../src/ez-async.js"],"sourcesContent":["\nexport default function async (generator) {\n  return function () {\n    var args = Array.prototype.slice.call(arguments)\n    return new Promise(function (resolve, reject) {\n      function getCallback (name) {\n        callbacks++\n        if (name == null) {\n          if (callbacks !== 1) {\n            gen.throw('You may either request several named callbacks or one unnamed callback!')\n          } else {\n            return function cb () {\n              callbacks--\n              handleResult(gen.next(Array.prototype.slice.call(arguments)))\n            }\n          }\n        } else {\n          if (callbackValues[name] != null) {\n            gen.throw('You already used that callback namespace! You need to `yield` first!')\n          } else {\n            return function cb () {\n              callbacks--\n              callbackValues[name] = Array.prototype.slice.call(arguments)\n              if (callbacks === 0) {\n                handleResult(gen.next(callbackValues))\n                callbackValues = {}\n              }\n            }\n          }\n        }\n      }\n      var callbacks = 0\n      var callbackValues = {}\n      var gen = generator.apply(this, [getCallback].concat(args))\n\n      function handleResult (result) {\n        if (result.done) {\n          resolve(result.value)\n        } else if (result.value instanceof Promise) {\n          if (callbacks > 0) {\n            gen.throw('You already requested callbacks. You must first await the callbacks before you can yield a promise!')\n          }\n          result.value.then(function (val) {\n            handleResult(gen.next([null, val]))\n          }, function (err) {\n            handleResult(gen.next([err || 'Promise was rejected']))\n          })\n        } else if (callbacks === 0) {\n          gen.throw('This object is not yield-able, also you did not request any callbacks!')\n        }\n      }\n      handleResult(gen.next())\n    })\n  }\n}\n"],"names":["async","generator","args","Array","prototype","slice","call","arguments","Promise","resolve","reject","getCallback","name","callbacks","gen","next","throw","callbackValues","handleResult","result","done","value","then","val","err","apply","this","concat"],"mappings":"mLACe,SAASA,GAAOC,SACtB,eACDC,GAAOC,MAAMC,UAAUC,MAAMC,KAAKC,iBAC/B,IAAIC,SAAQ,SAAUC,EAASC,WAC3BC,GAAaC,UAER,MAARA,EAAc,IACE,IAAdC,QAGK,kBAEQC,EAAIC,KAAKZ,MAAMC,UAAUC,MAAMC,KAAKC,gBAJ/CS,MAAM,+EAOP,IACuB,MAAxBC,EAAeL,SAGV,kBAEUA,GAAQT,MAAMC,UAAUC,MAAMC,KAAKC,WAChC,IAAdM,MACWC,EAAIC,KAAKE,aANtBD,MAAM,iFAiBPE,GAAcC,GACjBA,EAAOC,OACDD,EAAOE,OACNF,EAAOE,gBAAiBb,UAC7BK,EAAY,KACVG,MAAM,yGAELK,MAAMC,KAAK,SAAUC,KACbT,EAAIC,MAAM,KAAMQ,MAC5B,SAAUC,KACEV,EAAIC,MAAMS,GAAO,6BAET,IAAdX,KACLG,MAAM,6EAjBVH,GAAY,EACZI,KACAH,EAAMb,EAAUwB,MAAMC,MAAOf,GAAagB,OAAOzB,MAkBxCY,EAAIC"}