{"version":3,"file":"ez-async.cjs.js","sources":["../src/ez-async.js"],"sourcesContent":["\nexport default function async (generator) {\n  return function () {\n    var args = Array.prototype.slice.call(arguments)\n    return new Promise(function (resolve, reject) {\n      function getCallback (name) {\n        callbacks++\n        if (name == null) {\n          if (callbacks !== 1) {\n            gen.throw('You may either request several named callbacks or one unnamed callback!')\n          } else {\n            return function cb () {\n              callbacks--\n              handleResult(gen.next(Array.prototype.slice.call(arguments)))\n            }\n          }\n        } else {\n          if (callbackValues[name] != null) {\n            gen.throw('You already used that callback namespace! You need to `yield` first!')\n          } else {\n            return function cb () {\n              callbacks--\n              callbackValues[name] = Array.prototype.slice.call(arguments)\n              if (callbacks === 0) {\n                handleResult(gen.next(callbackValues))\n                callbackValues = {}\n              }\n            }\n          }\n        }\n      }\n      var callbacks = 0\n      var callbackValues = {}\n      var gen = generator.apply(this, [getCallback].concat(args))\n\n      function handleResult (result) {\n        if (result.done) {\n          resolve(result.value)\n        } else if (result.value instanceof Promise) {\n          if (callbacks > 0) {\n            gen.throw('You already requested callbacks. You must first await the callbacks before you can yield a promise!')\n          }\n          result.value.then(function (val) {\n            handleResult(gen.next([null, val]))\n          }, function (err) {\n            handleResult(gen.next([err || 'Promise was rejected']))\n          })\n        } else if (callbacks === 0) {\n          gen.throw('This object is not yield-able, also you did not request any callbacks!')\n        }\n      }\n      handleResult(gen.next())\n    })\n  }\n}\n"],"names":[],"mappings":";;AACe,SAAS,KAAK,EAAE,SAAS,EAAE;EACxC,OAAO,YAAY;IACjB,IAAI,IAAI,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC;IAChD,OAAO,IAAI,OAAO,CAAC,UAAU,OAAO,EAAE,MAAM,EAAE;MAC5C,SAAS,WAAW,EAAE,IAAI,EAAE;QAC1B,SAAS,EAAE;QACX,IAAI,IAAI,IAAI,IAAI,EAAE;UAChB,IAAI,SAAS,KAAK,CAAC,EAAE;YACnB,GAAG,CAAC,KAAK,CAAC,yEAAyE,CAAC;WACrF,MAAM;YACL,OAAO,SAAS,EAAE,IAAI;cACpB,SAAS,EAAE;cACX,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;aAC9D;WACF;SACF,MAAM;UACL,IAAI,cAAc,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE;YAChC,GAAG,CAAC,KAAK,CAAC,sEAAsE,CAAC;WAClF,MAAM;YACL,OAAO,SAAS,EAAE,IAAI;cACpB,SAAS,EAAE;cACX,cAAc,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC;cAC5D,IAAI,SAAS,KAAK,CAAC,EAAE;gBACnB,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;gBACtC,cAAc,GAAG,EAAE;eACpB;aACF;WACF;SACF;OACF;MACD,IAAI,SAAS,GAAG,CAAC;MACjB,IAAI,cAAc,GAAG,EAAE;MACvB,IAAI,GAAG,GAAG,SAAS,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,WAAW,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;;MAE3D,SAAS,YAAY,EAAE,MAAM,EAAE;QAC7B,IAAI,MAAM,CAAC,IAAI,EAAE;UACf,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC;SACtB,MAAM,IAAI,MAAM,CAAC,KAAK,YAAY,OAAO,EAAE;UAC1C,IAAI,SAAS,GAAG,CAAC,EAAE;YACjB,GAAG,CAAC,KAAK,CAAC,qGAAqG,CAAC;WACjH;UACD,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE;YAC/B,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC;WACpC,EAAE,UAAU,GAAG,EAAE;YAChB,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,sBAAsB,CAAC,CAAC,CAAC;WACxD,CAAC;SACH,MAAM,IAAI,SAAS,KAAK,CAAC,EAAE;UAC1B,GAAG,CAAC,KAAK,CAAC,wEAAwE,CAAC;SACpF;OACF;MACD,YAAY,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC;KACzB,CAAC;GACH;CACF,;;"}